<html>
  <head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jsrender/0.9.84/jsrender.min.js"></script>
    <script src="//use.fontawesome.com/c938e2358b.js"></script>
    <script src="travis.js"></script>
    <link rel="stylesheet" href="travis.css">
  </head>
  <body>
    <div id="header">
      <h1><a href="/">Selenium Travis CI Dashboard</a></h1>
    </div>
    <div id="body">
      <div id="sidebar1" class="sidebar">
      </div>
      <div id="content">
        <div id="metadata"></div>
        <div id="table-jobs"></div>
      </div>
    </div>

    <script id="sidebar-builds-tmpl" type="text/x-jsrender">
      <h2>Builds</h2>
      <ul id="sidebar-builds">{{for records}}
        <li class="{{:active}}"><a href="/build.html?id={{:id}}">{{:stateIcon}}{{:number}}</a></li>
      {{/for}}</ul>
    </script>

    <script id="metadata-tmpl" type="text/x-jsrender">
      <div id="commit-info">
        <i class="fa fa-github" aria-hidden="true"></i>
        <a href="https://github.com/SeleniumHQ/selenium/commit/{{:commit}}">{{:commitMessage}}</a>
        <span class="author">by {{:commitAuthor}}</span> in <span class="branch">{{:branch}}</span>
      </div>
      <div id="build-info">
        {{:stateIcon}}
        <span class="info">Build #{{:number}}</span>
        <i class="fa fa-calendar" aria-hidden="true"></i><span class="started">{{:startedAt}}</span>
        <i class="fa fa-clock-o" aria-hidden="true"></i><span class="duration">{{:duration}}</span>
      </div>
    </script>

    <script id="table-jobs-tmpl" type="text/x-jsrender">
      <table>
        <thead>
        <tr>
          <th>Job</th>
          <th>Started</th>
          <th>Finished</th>
          <th>Duration</th>
          <th>OS</th>
          <th>Language</th>
          <th>Env</th>
        </tr>
        </thead>
        <tbody>{{for records}}
          <tr job-id="{{:id}}">
            <td class="info">{{:stateIcon}}#{{:number}}</td>
            <td class="started"><i class="fa fa-calendar" aria-hidden="true"></i>{{:started}}</td>
            <td class="started"><i class="fa fa-flag-checkered" aria-hidden="true"></i>{{:finished}}</td>
            <td class="duration"><i class="fa fa-clock-o" aria-hidden="true"></i>{{:duration}}</td>
            <td class="os"><i class="fa fa-{{:os}}" aria-hidden="true"></i></td>
            <td class="language">{{:language}}</td>
            <td class="env">{{:env}}</td>
          </tr>
        {{/for}}</tbody>
      </table>
    </script>

    <script>
      var queryString = window.location.href.slice(window.location.href.indexOf("?") + 1);
      var buildId = queryString.slice(queryString.indexOf("=") + 1);

      var sidebarBuildsTmpl = $.templates("#sidebar-builds-tmpl");
      $.getJSON("/rest/builds", function(data) {
        data["records"].forEach(function(build) {
          build["stateIcon"] = stateIcon(build["state"]);
          build["active"] = build["id"] == buildId ? "active" : "";
        });
        $("#sidebar1").html(sidebarBuildsTmpl.render(data));
      });

      var metadataTmpl = $.templates("#metadata-tmpl");
      $.getJSON("/rest/build/"+buildId, function(data) {
        data["stateIcon"] = stateIcon(data["state"]);
        $("#metadata").html(metadataTmpl.render(data));
      });

      var jobTableTmpl = $.templates("#table-jobs-tmpl");
      $.getJSON("/rest/jobs/"+buildId, function(data) {
        data["records"].forEach(function(job) {
          job["stateIcon"] = stateIcon(job["state"]);
        });
        $("#table-jobs").html(jobTableTmpl.render(data));
      });

      $("#table-jobs").on("click", "tbody tr", function() {
        window.location = "job.html?id=" + $(this).attr("job-id");
      });
    </script>
  </body>
</html>
